# ガンスリンガー方式バトル マッチングシステム

ガンスリンガー方式のマッチングを管理するためのシステムです。主にポケモンカードバトル大会向けに設計しており、Google Apps Script (GAS) とスプレッドシートで動作します。

## 機能一覧

- プレイヤー管理
  - プレイヤー登録処理
  - プレイヤー休憩・復帰処理
  - プレイヤードロップアウト処理
- 自動マッチング（再戦回避機能付き）
  - 勝者優先マッチング（勝数が多い順、同勝数なら先着順）
  - 過去対戦相手の自動記録と再戦回避
  - 卓番号の自動管理・卓数管理
  - 対戦経過時間の表示
- 対戦結果記録
  - プレイヤー毎の勝敗統計の自動更新
  - 対戦履歴の記録

## セットアップ方法

### 1. スプレッドシートの準備

1. [Google スプレッドシート](https://sheets.google.com/) を新規作成します。
2. 「拡張機能」→「Apps Script」を開きます。
3. 本リポジトリの各 `.js` ファイルをスクリプトエディタにコピーします。
4. スクリプトを保存してスプレッドシートに戻します。
5. ページを更新すると「🃏 ガンスリンガーマッチング」メニューが表示されます。

### 2. 大会運用の開始

1. カスタムメニューから「🏁 大会開始」を実行してください。
2. 3つのシート（プレイヤー、対戦履歴、マッチング）が自動で作成されます。
3. カスタムメニューから「➕ プレイヤーを追加する」でプレイヤーを登録します。
4. 待機プレイヤーが2人以上になると自動でマッチングが開始されます。
5. 対戦終了後は「✅ 対戦結果の記録」で勝者を記録してください。
6. 必要に応じて休憩・復帰・ドロップアウト処理を実行してください。

### 3.大会の終了

1. カスタムメニューから「🏁 大会終了」を実行してください。
2. プレイヤーシートと対戦履歴シートのバックアップ（`(プレイヤー|対戦履歴)_YYYYMMDD_HHmmss`）を作成します。

## 使用方法

### カスタムメニュー操作

- **🏁 大会開始**: シートの初期化（プレイヤー / 対戦履歴 / マッチング）を行い、大会運用モードに入ります。
- **🏁 大会終了**: 対戦履歴シートのバックアップ（`対戦履歴_YYYYMMDD_HHmmss`）を作成します。
- **➕ プレイヤーを追加する**: 新しいプレイヤーを登録します（自動IDで採番されます）。
- **🖊️ プレイヤー名を編集**: 既存プレイヤーの表示名を編集します（進行中の対戦表示と対戦履歴の勝者/敗者名も更新されます）。
- **✅ 対戦結果の記録**: 勝者を指定して対戦を終了し、統計を自動で更新します。
- **☕ プレイヤーを休憩させる**: 一時的に対戦から離脱させます（後で復帰できます）。
- **↩️ 休憩から復帰させる**: 休憩中のプレイヤーを待機状態に戻します（自動マッチングが発動します）。
- **❌ プレイヤーをドロップアウトさせる**: 大会から完全に退出させます（復帰不可です）。
- **🔧 対戦結果の修正**: 誤って記録した対戦結果を修正できます。
- **⚙️ 最大卓数の設定**: 使用する卓の最大数を設定します（1～200、デフォルト: 50）。

### データシート構成

システムは以下の3つのシートを使用します。

1. **プレイヤーシート**: プレイヤーマスタ。プレイヤーID、名前、勝敗数、試合数、参加状況、最終対戦時刻を管理します。

2. **対戦履歴シート**: 完了した対戦の記録。対戦の時刻、卓番号、両プレイヤーのIDと名前、対戦IDなどを記録し、`勝者名` 列に勝者、`敗者名` 列に敗者を保存します。

3. **マッチングシート**: 現在進行中の対戦。卓番号、両プレイヤーのID・名前、対戦開始時刻、経過時間を表示します。

## よくある質問

### Q. 最大何人まで管理できますか？

A. プレイヤー数に制限はありませんが、50人以上での運用を想定した最適化を行っています。

### Q. 卓数の上限は変更できますか？

A. カスタムメニューの「⚙️ 最大卓数の設定」から1～200の範囲で設定できます（デフォルト: 50卓）。

### Q. 対戦結果を間違えて記録してしまいました

A. カスタムメニューの「🔧 対戦結果の修正」から修正できます。対戦IDを指定して新しい勝者を入力してください。

### Q. プレイヤーが一時的に離席する場合は？

A. 「☕ プレイヤーを休憩にする」を使用してください。復帰時は「↩️ 休憩から復帰させる」で待機状態に戻ります。

### Q. 開発に参加したいのですが

A. [.github/copilot-instructions.md](.github/copilot-instructions.md) に開発者向けの詳細情報がありますのでご確認ください。PRも歓迎します！

## 作者

springOK

## ライセンス

MIT License

Copyright (c) 2025 springOK

このソフトウェアはMITライセンスの下で公開されています。
詳細は [LICENSE](LICENSE) ファイルを参照してください。
